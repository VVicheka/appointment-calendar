<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Khmer Lunar Calendar 2026</title>
    
    <!-- Bootstrap 5 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Kantumruy Pro Font -->
    <link href="https://fonts.googleapis.com/css2?family=Kantumruy+Pro:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --calendar-green: #00b300;
            --calendar-green-dark: #009900;
            --holiday-red: #ff0000;
            --event-blue: #0066cc;
            --light-bg: #f8f9fa;
            --border-color: #dee2e6;
            --text-dark: #2c3e50;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Kantumruy Pro', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background-color: white;
            color: var(--text-dark);
            font-size: 14px;
        }

        /* Header */
        .calendar-header-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 1.5rem;
            background: white;
            border-bottom: 1px solid var(--border-color);
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .nav-arrow {
            background: none;
            border: none;
            font-size: 0.9rem;
            cursor: pointer;
            color: #333;
            padding: 0.25rem;
        }

        .nav-arrow:hover {
            color: var(--calendar-green);
        }

        .header-title {
            font-size: 1.15rem;
            font-weight: 600;
            color: #333;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .lunar-info {
            font-size: 0.85rem;
            color: #333;
            font-weight: 500;
        }

        .lang-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.4rem 0.8rem;
            background: white;
            border: 2px solid var(--calendar-green);
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            font-size: 0.85rem;
        }

        .lang-flag {
            width: 24px;
            height: 24px;
        }

        /* Main Layout */
        .calendar-container {
            display: flex;
            height: calc(100vh - 80px);
        }

        /* Calendar Section */
        .calendar-main {
            width: 60%;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .calendar-weekdays-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: var(--calendar-green);
            color: white;
            font-weight: 700;
        }

        .weekday-cell {
            padding: 0.5rem;
            text-align: center;
            border-right: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.95rem;
            font-weight: 500;
        }

        .weekday-cell:last-child {
            border-right: none;
        }

        .calendar-body {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .calendar-row {
            flex: 1;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            border-bottom: 1px solid var(--border-color);
        }

        .calendar-row:last-child {
            border-bottom: none;
        }

        /* Week Sidebar */
        .week-sidebar {
            background: var(--calendar-green);
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-right: 1px solid var(--border-color);
            padding: 0.5rem;
            font-weight: 600;
        }

        .week-number {
            font-size: 1.5rem;
        }

        .week-lunar {
            font-size: 0.85rem;
        }

        /* Day Cell */
        .day-cell {
            border-right: 1px solid var(--border-color);
            padding: 0.3rem;
            margin: 0 0.05rem;
            background: white;
            position: relative;
            display: flex;
            flex-direction: column;
            cursor: pointer;
            transition: background 0.2s;
            overflow: hidden;
        }

        .day-cell:hover {
            background: #f0f8ff;
        }

        .day-cell:last-child {
            border-right: none;
        }

        .day-cell.other-month {
            background: #fafafa;
            opacity: 0.6;
        }

        .day-cell.today {
            background: #90EE90 !important;
        }

        .day-cell.weekend {
            background: #f9f9f9;
        }

        .day-header-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.3rem;
        }

        .day-number {
            font-size: 1.4rem;
            font-weight: 600;
            line-height: 1;
        }

        .day-cell.holiday .day-number {
            color: var(--holiday-red);
        }

        .buddhist-icon {
            width: 16px;
            height: 16px;
        }

        .lunar-date {
            font-size: 0.7rem;
            color: #555;
            margin-bottom: 0.2rem;
            font-weight: 500;
        }

        .day-info {
            font-size: 0.65rem;
            line-height: 1.1;
            margin-top: 0.2rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .holiday-text {
            color: var(--holiday-red);
            font-weight: 500;
        }

        .event-text {
            color: var(--event-blue);
            font-weight: 500;
        }

        .buddhist-event-text {
            color: #9933cc;
            font-weight: 500;
        }

        .special-day {
            color: #666;
            font-weight: 400;
        }

        /* Date Info Modal */
        .date-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .date-modal.show {
            display: flex;
        }

        .date-modal-content {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        .date-modal-content.has-buddha-bg {
            background-image: url('buddha-icon.png');
            background-repeat: no-repeat;
            background-position: right center;
            background-size: 150px 150px;
        }

        .date-modal-content.has-buddha-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(to right, rgba(255, 255, 255, 0.95) 60%, rgba(255, 255, 255, 0.7) 100%);
            border-radius: 12px;
            z-index: 0;
        }

        .date-modal-content > * {
            position: relative;
            z-index: 1;
        }

        .date-modal-close {
            position: absolute;
            top: 0.8rem;
            right: 0.8rem;
            background: none;
            border: none;
            font-size: 1.3rem;
            cursor: pointer;
            color: #666;
        }

        .date-modal-close:hover {
            color: #000;
        }

        .date-modal-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1.2rem;
            color: #333;
            text-align: center;
        }

        .date-modal-text {
            font-size: 0.9rem;
            line-height: 1.6;
            color: #333;
            margin-bottom: 0.8rem;
            white-space: pre-line;
        }

        .date-modal-date-en {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 1.2rem;
        }

        .date-modal-actions {
            display: flex;
            gap: 0.8rem;
            margin-top: 1.5rem;
        }

        .date-modal-btn {
            flex: 1;
            padding: 0.6rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
            font-size: 0.8rem;
            transition: all 0.2s;
        }

        .date-modal-btn:hover {
            background: #f0f8ff;
            border-color: var(--calendar-green);
        }

        /* Appointments Sidebar */
        .holidays-sidebar {
            width: 40%;
            background: white;
            border-left: 1px solid var(--border-color);
            overflow-y: auto;
            padding: 1rem;
        }

        .sidebar-title {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--calendar-green);
        }

        .holiday-item {
            display: flex;
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .holiday-date {
            text-align: center;
            min-width: 50px;
        }

        .holiday-day-name {
            font-size: 0.7rem;
            color: #666;
            margin-bottom: 0.2rem;
        }

        .holiday-day-num {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
        }

        .holiday-details h6 {
            font-weight: 500;
            margin: 0;
            font-size: 0.85rem;
            line-height: 1.3;
        }

        .holiday-details h6.holiday-red {
            color: var(--holiday-red);
        }

        .holiday-details h6.event-blue {
            color: var(--event-blue);
        }

        .holiday-details h6.buddhist-purple {
            color: #9933cc;
        }

        /* Appointment Items */
        .appointment-item {
            background: #f8f9fa;
            border-left: 4px solid var(--calendar-green);
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .appointment-item:hover {
            background: #e9ecef;
            transform: translateX(2px);
        }

        .appointment-date {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.3rem;
        }

        .appointment-title {
            font-size: 0.9rem;
            font-weight: 500;
            color: #333;
            margin-bottom: 0.2rem;
        }

        .appointment-time {
            font-size: 0.75rem;
            color: #666;
        }

        .no-appointments {
            text-align: center;
            padding: 2rem 1rem;
            color: #999;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .holidays-sidebar {
                width: 40%;
            }
        }

        @media (max-width: 991px) {
            .calendar-container {
                flex-direction: column;
                height: auto;
            }
            
            .calendar-main {
                width: 100%;
            }
            
            .holidays-sidebar {
                width: 100%;
                border-left: none;
                border-top: 1px solid var(--border-color);
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="calendar-header-bar">
        <div class="header-nav">
            <button class="nav-arrow btn-prev-month">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button class="nav-arrow btn-refresh">
                <i class="fas fa-sync-alt"></i>
            </button>
            <button class="nav-arrow btn-next-month">
                <i class="fas fa-chevron-right"></i>
            </button>
            <h1 class="header-title" id="headerTitle"></h1>
        </div>
        <div class="header-info">
            <div class="lunar-info" id="lunarInfo"></div>
            <div class="lang-toggle" id="langToggle">
                <span class="lang-flag">ğŸ‡¬ğŸ‡§</span>
                <span id="langText">English</span>
            </div>
            <button class="nav-arrow">
                <i class="fas fa-cog"></i>
            </button>
            <button class="nav-arrow">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </div>

    <!-- Main Container -->
    <div class="calendar-container">
        <!-- Calendar Section -->
        <div class="calendar-main">
            <!-- Weekdays Header -->
            <div class="calendar-weekdays-row">
                <div class="weekday-cell" id="weekday0"></div>
                <div class="weekday-cell" id="weekday1"></div>
                <div class="weekday-cell" id="weekday2"></div>
                <div class="weekday-cell" id="weekday3"></div>
                <div class="weekday-cell" id="weekday4"></div>
                <div class="weekday-cell" id="weekday5"></div>
                <div class="weekday-cell" id="weekday6"></div>
            </div>
            
            <!-- Calendar Body -->
            <div class="calendar-body" id="calendarBody"></div>
        </div>

        <!-- Appointments Sidebar -->
        <div class="holidays-sidebar">
            <div class="sidebar-title" id="sidebarTitle">Appointments</div>
            <div id="appointmentsList"></div>
        </div>
    </div>

    <!-- Date Info Modal -->
    <div class="date-modal" id="dateModal">
        <div class="date-modal-content">
            <button class="date-modal-close" onclick="closeDateModal()">Ã—</button>
            <div class="date-modal-title" id="modalTitle"></div>
            <div class="date-modal-text" id="modalText"></div>
            <div class="date-modal-date-en" id="modalDateEn"></div>
            <div class="date-modal-actions">
                <button class="date-modal-btn" onclick="copyText()">
                    <i class="fas fa-copy"></i>
                    <span id="btnCopyText">Copy text</span>
                </button>
                <button class="date-modal-btn" onclick="addAppointment()">
                    <i class="fas fa-plus"></i>
                    <span id="btnAddAppointment">Add Appointment</span>
                </button>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- MomentKH Library -->
    <script src="https://cdn.jsdelivr.net/gh/ThyrithSor/momentkh@3.0.3/momentkh.js"></script>
    
    <script>
        $(document).ready(function() {
            let currentDate = new Date();
            let currentLanguage = localStorage.getItem('calendar-language') || 'en';
            let selectedDateInfo = null;
            let appointments = JSON.parse(localStorage.getItem('calendar-appointments')) || [];

            // Cambodian Public Holidays and Events
            const holidays = {
                '2026-01-01': { en: 'New Year\'s Day', kh: 'ááŸ’á„áŸƒá…á¼á›á†áŸ’á“á¶áŸ†áŸá¶á€á›', isRestDay: true },
                '2026-01-07': { en: 'Victory Over Genocide Day', kh: 'á‘á·áœá¶á‡áŸá™á‡á˜áŸ’á“áŸ‡á›á¾ášá”á”á”áŸ’ášá›áŸá™á–á¼á‡áŸá¶áŸá“áŸ', isRestDay: true },
                '2026-03-08': { en: 'International Women\'s Day', kh: 'á‘á·áœá¶á¢á“áŸ’áášá‡á¶áá·á“á¶ášá¸', isRestDay: true },
                '2026-04-05': { en: 'Tomb-Sweeping Day (Qingming Festival)', kh: 'á‘á·áœá¶áŸá˜áŸ’á¢á¶áá•áŸ’á“á¼áš', isRestDay: false },
                '2026-04-07': { en: 'World Health Day', kh: 'á‘á·áœá¶áŸá»áá—á¶á–á–á·á—á–á›áŸ„á€', isRestDay: false },
                '2026-04-08': { en: 'International Buddhist Day', kh: 'á‘á·áœá¶á–á»á‘áŸ’á’áŸá¶áŸá“á·á€á¢á“áŸ’áášá‡á¶áá·', isRestDay: false },
                '2026-04-14': { en: 'Khmer New Year - Maha Songkran at 10:48 AM', kh: 'á…á¼á›á†áŸ’á“á¶áŸ†ááŸ’á˜áŸ‚áš á–áŸ’ášáŸ‡á‚á»áá”á»áŸáŸ’áŸá¸ á–áŸ’ášá¶áŸ†á–áŸ’ášá¼á›áŸ’áœá€áŸ á˜áŸ‰áŸ„á„ááŸ’á„áŸƒááŸ’ášá„áŸ‹ áŸ¡áŸ :áŸ¤áŸ¨ AM', isRestDay: true },
                '2026-04-15': { en: 'Khmer New Year - Vara Vanabat', kh: 'á…á¼á›á†áŸ’á“á¶áŸ†ááŸ’á˜áŸ‚áš áœá¶ášáŸˆáœáŸá“á”á', isRestDay: true },
                '2026-04-16': { en: 'Khmer New Year - Vara Loeng Sak', kh: 'á…á¼á›á†áŸ’á“á¶áŸ†ááŸ’á˜áŸ‚áš ááŸ’á„áŸƒá¡á¾á„áŸáŸá€', isRestDay: true },
                '2026-04-28': { en: 'World Day for Safety and Health at Work', kh: 'á‘á·áœá¶á–á·á—á–á›áŸ„á€áŸá˜áŸ’ášá¶á”áŸ‹áŸá»áœááŸ’áá·á—á¶á– á“á·á„áŸá»áá—á¶á–á€á¶ášá„á¶áš á†áŸ’á“á¶áŸ†áŸ¢áŸ áŸ¢áŸ¦', isRestDay: false },
                '2026-04-30': { en: 'Cambodia joined The Association of Southeast Asian Nations (ASEAN)', kh: 'á€á˜áŸ’á–á»á‡á¶á…á¼á›ášá½á˜á‡á¶á˜á½á™á¢á¶áŸáŸŠá¶á“ á†áŸ’á“á¶áŸ†áŸ¡áŸ©áŸ©áŸ©', isRestDay: false },
                '2026-05-01': { en: 'Labour Day', kh: 'á‘á·áœá¶á–á›á€á˜áŸ’á˜á¢á“áŸ’áášá‡á¶áá·', isRestDay: true },
                '2026-05-14': { en: 'Royal Ploughing Ceremony', kh: 'á–áŸ’ášáŸ‡ášá¶á‡á–á·á’á¸á…áŸ’ášááŸ‹á–áŸ’ášáŸ‡á“á„áŸ’á‚áŸá›', isRestDay: true },
                '2026-06-01': { en: 'Children\'s Day', kh: 'á‘á·áœá¶á€á»á˜á¶ášá¢á“áŸ’áášá‡á¶áá·', isRestDay: true },
                '2026-06-18': { en: 'Queen\'s Birthday', kh: 'á–áŸ’ášáŸ‡á‡á“áŸ’á˜á–áŸ’ášáŸ‡á˜á á¶á€áŸ’áŸááŸ’ášá¸', isRestDay: true },
                '2026-09-24': { en: 'Constitution Day', kh: 'á‘á·áœá¶ášáŠáŸ’á‹á’á˜áŸ’á˜á“á»á‰áŸ’á‰', isRestDay: true },
                '2026-10-15': { en: 'Mourning King Father', kh: 'á”áŸ’ášá¶ášá–áŸ’á’á‘á»á€áŸ’áá–áŸ’ášáŸ‡á”á¶á‘', isRestDay: true },
                '2026-10-29': { en: 'King\'s Birthday', kh: 'á–áŸ’ášáŸ‡á‡á“áŸ’á˜á–áŸ’ášáŸ‡á˜á á¶á€áŸ’áŸááŸ’áš', isRestDay: true },
                '2026-11-09': { en: 'Independence Day', kh: 'á‘á·áœá¶á¯á€ášá¶á‡áŸ’á™á‡á¶áá·', isRestDay: true },
            };

            // Buddhist Ceremonies and Events (not rest days, just ceremonial)
            const buddhistEvents = {
                '2026-02-02': { en: 'Meak Bochea', kh: 'á–á·á’á¸á”á»ááŸ’á™á˜á¶áƒá”á¼á‡á¶' },
                '2026-02-11': { en: 'Kitchen God Festival', kh: 'ááŸ’áœá¶á™á”á„áŸ’á‚áŸ†á–áŸ’ášáŸ‡á—á¼á˜á·' },
                '2026-02-16': { en: 'Chinese New Year\'s Eve', kh: 'ááŸ’á„áŸƒá…á¼á›á†áŸ’á“á¶áŸ†á…á·á“' },
                '2026-02-17': { en: 'Chinese New Year', kh: 'á…á¼á›á†áŸ’á“á¶áŸ†á…á·á“' },
                '2026-02-18': { en: 'Chinese New Year', kh: 'á…á¼á›á†áŸ’á“á¶áŸ†á…á·á“' },
                '2026-02-19': { en: 'Chinese New Year', kh: 'á…á¼á›á†áŸ’á“á¶áŸ†á…á·á“' },
                '2026-05-12': { en: 'Visakha Bochea', kh: 'á–á·á’á¸á”á»ááŸ’á™áœá·áŸá¶áá”á¼á‡á¶' },
                '2026-07-09': { en: 'Asalha Bochea', kh: 'á–á·á’á¸á”á»ááŸ’á™á¢á¶áŸá¶á¡áŸ’á á”á¼á‡á¶' },
                '2026-07-10': { en: 'Buddhist Lent Begins', kh: 'á…á¼á›áœáŸáŸ’áŸá¶' },
                '2026-10-07': { en: 'Pchum Ben', kh: 'á–á·á’á¸á”á»ááŸ’á™á—áŸ’á‡á»áŸ†á”á·ááŸ’áŒ' },
                '2026-10-08': { en: 'Pchum Ben', kh: 'á–á·á’á¸á”á»ááŸ’á™á—áŸ’á‡á»áŸ†á”á·ááŸ’áŒ' },
                '2026-10-09': { en: 'Pchum Ben', kh: 'á–á·á’á¸á”á»ááŸ’á™á—áŸ’á‡á»áŸ†á”á·ááŸ’áŒ' },
                '2026-11-03': { en: 'Water Festival', kh: 'á–á·á’á¸á”á»ááŸ’á™á¢á»áŸ†á‘á¼á€' },
                '2026-11-04': { en: 'Water Festival', kh: 'á–á·á’á¸á”á»ááŸ’á™á¢á»áŸ†á‘á¼á€' },
                '2026-11-05': { en: 'Water Festival', kh: 'á–á·á’á¸á”á»ááŸ’á™á¢á»áŸ†á‘á¼á€' },
            };

            // Translations
            const translations = {
                en: {
                    months: ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'],
                    daysShort: ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'],
                    daysFull: ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'],
                    shaveDay: 'Shave Day',
                    fullMoon: 'Full Moon',
                    koeut: 'Koeut',
                    roach: 'Roach',
                    today: 'Today'
                },
                kh: {
                    months: ['á˜á€ášá¶', 'á€á»á˜áŸ’á—áŸˆ', 'á˜á¸á“á¶', 'á˜áŸáŸá¶', 'á§áŸá—á¶', 'á˜á·áá»á“á¶', 'á€á€áŸ’á€áŠá¶', 'áŸá¸á á¶', 'á€á‰áŸ’á‰á¶', 'áá»á›á¶', 'áœá·á…áŸ’á†á·á€á¶', 'á’áŸ’á“á¼'],
                    daysShort: ['á¢á¶á‘á·ááŸ’á™', 'á…á“áŸ’á‘', 'á¢á„áŸ’á‚á¶áš', 'á–á»á’', 'á–áŸ’ášá áŸáŸ’á”áá·áŸ', 'áŸá»á€áŸ’áš', 'áŸáŸ…ášáŸ'],
                    daysFull: ['á¢á¶á‘á·ááŸ’á™', 'á…á“áŸ’á‘', 'á¢á„áŸ’á‚á¶áš', 'á–á»á’', 'á–áŸ’ášá áŸáŸ’á”áá·áŸ', 'áŸá»á€áŸ’áš', 'áŸáŸ…ášáŸ'],
                    shaveDay: 'ááŸ’á„áŸƒá€áŸ„áš',
                    fullMoon: 'á–áŸá‰á”á¼ááŸŒá˜á¸',
                    koeut: 'á€á¾á',
                    roach: 'ášáŸ„á…',
                    today: 'ááŸ’á„áŸƒá“áŸáŸ‡'
                }
            };

            // Khmer Number Converter - DISABLED, always use Arabic numerals
            function toKhmerNumber(num) {
                return num; // Always return Arabic numerals
            }

            // Get Buddhist Date Info
            function getBuddhistDateInfo(date) {
                try {
                    const year = date.getFullYear();
                    const month = date.getMonth() + 1;
                    const day = date.getDate();
                    
                    const khmerDate = momentkh.fromGregorian(year, month, day);
                    
                    const lunarDay = khmerDate.khmer.day;
                    const moonPhase = khmerDate.khmer.moonPhase;
                    const monthName = khmerDate.khmer.monthName;
                    const animalYearName = khmerDate.khmer.animalYearName;
                    const sakName = khmerDate.khmer.sakName;
                    const beYear = khmerDate.khmer.beYear;
                    const dayOfWeekName = khmerDate.khmer.dayOfWeekName;
                    
                    const isBuddhistHolyDay = 
                        (moonPhase === 0 && (lunarDay === 1 || lunarDay === 8 || lunarDay === 15)) ||
                        (moonPhase === 1 && (lunarDay === 8 || lunarDay === 15));
                    
                    const isShaveDay = moonPhase === 1 && (lunarDay === 14 || lunarDay === 15);
                    const isFullMoon = moonPhase === 0 && lunarDay === 15;
                    
                    let lunarDateStr = '';
                    if (currentLanguage === 'en') {
                        lunarDateStr = `${lunarDay} ${moonPhase === 0 ? translations.en.koeut : translations.en.roach}`;
                    } else {
                        // Use Arabic numerals even in Khmer mode
                        lunarDateStr = `${lunarDay}${moonPhase === 0 ? translations.kh.koeut : translations.kh.roach}`;
                    }
                    
                    return {
                        lunarDay,
                        moonPhase,
                        monthName,
                        animalYearName,
                        sakName,
                        beYear,
                        dayOfWeekName,
                        isBuddhistHolyDay,
                        isShaveDay,
                        isFullMoon,
                        lunarDateStr,
                        fullKhmerDate: khmerDate
                    };
                } catch (e) {
                    console.error('MomentKH error:', e);
                    return null;
                }
            }

            // Get lunar month range for header
            function getLunarMonthRange(year, month) {
                try {
                    const firstDay = momentkh.fromGregorian(year, month, 1);
                    const lastDay = momentkh.fromGregorian(year, month, new Date(year, month, 0).getDate());
                    
                    const firstMonth = firstDay.khmer.monthName;
                    const lastMonth = lastDay.khmer.monthName;
                    const animalYear = firstDay.khmer.animalYearName;
                    const beYear = firstDay.khmer.beYear; // Always Arabic numerals
                    
                    if (firstMonth === lastMonth) {
                        return `${firstMonth}, ${animalYear} ${currentLanguage === 'en' ? 'B.E.' : 'á–.áŸ.'} ${beYear}`;
                    } else {
                        return `${firstMonth} - ${lastMonth}, ${animalYear} ${currentLanguage === 'en' ? 'B.E.' : 'á–.áŸ.'} ${beYear}`;
                    }
                } catch (e) {
                    return '';
                }
            }

            // Format date for key
            function formatDateKey(date) {
                const year = date.getFullYear();
                const month = String(date.getMonth() + 1).padStart(2, '0');
                const day = String(date.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            }

            // Show date modal
            window.showDateModal = function(date) {
                const buddhistInfo = getBuddhistDateInfo(date);
                if (!buddhistInfo) return;

                selectedDateInfo = {
                    date: date,
                    buddhistInfo: buddhistInfo
                };

                // Add Buddha background if holy day
                if (buddhistInfo.isBuddhistHolyDay) {
                    $('.date-modal-content').addClass('has-buddha-bg');
                } else {
                    $('.date-modal-content').removeClass('has-buddha-bg');
                }

                const today = new Date();
                const isToday = date.toDateString() === today.toDateString();

                const dayOfWeek = translations[currentLanguage].daysFull[date.getDay()];
                const gregorianDay = date.getDate(); // Always Arabic numerals
                const gregorianMonth = translations[currentLanguage].months[date.getMonth()];
                const gregorianYear = date.getFullYear(); // Always Arabic numerals
                
                // Title
                if (currentLanguage === 'kh') {
                    if (isToday) {
                        $('#modalTitle').text('ááŸ’á„áŸƒá“áŸáŸ‡:');
                    } else {
                        $('#modalTitle').text(`ááŸ’á„áŸƒá‘á¸${gregorianDay}ááŸ‚${gregorianMonth} á†áŸ’á“á¶áŸ†${gregorianYear}`);
                    }
                } else {
                    if (isToday) {
                        $('#modalTitle').text('Today');
                    } else {
                        $('#modalTitle').text(`${gregorianMonth} ${gregorianDay}, ${gregorianYear}`);
                    }
                }
                
                // Modal text
                if (currentLanguage === 'kh') {
                    // Khmer: Buddhist date first, then "ááŸ’ášá¼áœá“á¹á„", then Gregorian
                    const khmerFullDate = momentkh.format(buddhistInfo.fullKhmerDate, "ááŸ’á„áŸƒW dN ááŸ‚m á†áŸ’á“á¶áŸ†a á–.áŸ.b");
                    const gregorianPart = `ááŸ’ášá¼áœá“á¹á„ ááŸ’á„áŸƒá‘á¸${gregorianDay} ${gregorianMonth} ${gregorianYear}`;
                    let modalText = `${khmerFullDate} ${gregorianPart}`;
                    
                    // Add all events for this day with colors
                    const dateKey = formatDateKey(date);
                    const holiday = holidays[dateKey];
                    const buddhistEvent = buddhistEvents[dateKey];
                    
                    if (holiday || buddhistEvent) {
                        modalText += '\n';
                        if (holiday) {
                            const colorStyle = holiday.isRestDay ? 'color: #ff0000' : 'color: #0066cc';
                            modalText += `\n<span style="${colorStyle}">â€¢ ${holiday.kh}</span>`;
                        }
                        if (buddhistEvent) {
                            modalText += `\n<span style="color: #9933cc">â€¢ ${buddhistEvent.kh}</span>`;
                        }
                    }
                    
                    $('#modalText').html(modalText.replace(/\n/g, '<br>'));
                    $('#modalDateEn').text(`${translations.en.months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`);
                } else {
                    // English: Gregorian first, then "which in Lunar is..."
                    const moonPhaseText = buddhistInfo.moonPhase === 0 ? 'Koeut' : 'Roach';
                    let text = `${dayOfWeek}, ${gregorianMonth} ${gregorianDay}, ${gregorianYear} which in Lunar is day of ${buddhistInfo.lunarDay} ${moonPhaseText}, month of ${buddhistInfo.monthName}, year of ${buddhistInfo.animalYearName}, ${buddhistInfo.sakName} era, Buddhist era ${buddhistInfo.beYear}`;
                    
                    // Add all events for this day with colors
                    const dateKey = formatDateKey(date);
                    const holiday = holidays[dateKey];
                    const buddhistEvent = buddhistEvents[dateKey];
                    
                    if (holiday || buddhistEvent) {
                        text += '\n';
                        if (holiday) {
                            const colorStyle = holiday.isRestDay ? 'color: #ff0000' : 'color: #0066cc';
                            text += `\n<span style="${colorStyle}">â€¢ ${holiday.en}</span>`;
                        }
                        if (buddhistEvent) {
                            text += `\n<span style="color: #9933cc">â€¢ ${buddhistEvent.en}</span>`;
                        }
                    }
                    
                    $('#modalText').html(text.replace(/\n/g, '<br>'));
                    $('#modalDateEn').text('');
                }
                
                $('#dateModal').addClass('show');
            };

            window.closeDateModal = function() {
                $('#dateModal').removeClass('show');
                selectedDateInfo = null;
            };

            window.copyText = function() {
                if (!selectedDateInfo) return;
                const text = $('#modalText').text() + '\n' + $('#modalDateEn').text();
                navigator.clipboard.writeText(text).then(() => {
                    alert(currentLanguage === 'en' ? 'Copied to clipboard!' : 'á…á˜áŸ’á›á„á‘áŸ…á€áŸ’áŠá¶ášáá˜áŸ’á”áŸ€áááŸ’á‘á¶áŸáŸ‹!');
                });
            };

            // Render Calendar
            function renderCalendar() {
                const year = currentDate.getFullYear();
                const month = currentDate.getMonth();
                
                // Update header
                const monthName = currentLanguage === 'en' 
                    ? `${translations.en.months[month]} ${year}`
                    : `${translations.kh.months[month]} ${year}`;
                $('#headerTitle').text(monthName);
                
                // Update lunar info
                $('#lunarInfo').text(getLunarMonthRange(year, month + 1));
                
                // Render weekdays
                for (let i = 0; i < 7; i++) {
                    $(`#weekday${i}`).text(translations[currentLanguage].daysShort[i]);
                }
                
                // Render calendar body
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                let calendarHtml = '';
                let dayCount = 1 - firstDay;
                
                // Always show 6 weeks
                for (let week = 0; week < 6; week++) {
                    calendarHtml += `<div class="calendar-row">`;
                    
                    // Day cells
                    for (let day = 0; day < 7; day++) {
                        const date = new Date(year, month, dayCount);
                        const isCurrentMonth = date.getMonth() === month;
                        calendarHtml += renderDay(date, !isCurrentMonth, day);
                        dayCount++;
                    }
                    
                    calendarHtml += `</div>`;
                }
                
                $('#calendarBody').html(calendarHtml);
                
                // Render appointments sidebar
                renderAppointments();
            }

            function renderDay(date, isOtherMonth, dayOfWeek) {
                const day = date.getDate();
                const dateKey = formatDateKey(date);
                const today = new Date();
                const isToday = date.toDateString() === today.toDateString();
                const holiday = holidays[dateKey];
                const buddhistInfo = getBuddhistDateInfo(date);
                
                let classes = 'day-cell';
                if (isOtherMonth) classes += ' other-month';
                if (isToday) classes += ' today';
                if (dayOfWeek === 0 || dayOfWeek === 6) classes += ' weekend';
                if (holiday && holiday.isRestDay) classes += ' holiday';
                
                let html = `<div class="${classes}" onclick="showDateModal(new Date('${date.toISOString()}'))">`;
                
                // Day header with number and Buddhist icon
                html += `<div class="day-header-row">`;
                html += `<div class="day-number">${day}</div>`; // Always Arabic numerals
                if (buddhistInfo && buddhistInfo.isBuddhistHolyDay) {
                    html += `<img src="buddha-icon.png" class="buddhist-icon" alt="Buddhist Holy Day" />`;
                }
                html += `</div>`;
                
                // Lunar date
                if (buddhistInfo) {
                    html += `<div class="lunar-date">${buddhistInfo.lunarDateStr}</div>`;
                    
                    // Special day markers (only for current month)
                    if (!isOtherMonth) {
                        if (buddhistInfo.isShaveDay) {
                            html += `<div class="day-info special-day">${translations[currentLanguage].shaveDay}</div>`;
                        }
                        if (buddhistInfo.isFullMoon) {
                            html += `<div class="day-info special-day">${translations[currentLanguage].fullMoon}</div>`;
                        }
                    }
                }
                
                // Holiday/Event text (show for all dates, not just current month)
                if (holiday) {
                    const holidayText = currentLanguage === 'kh' ? holiday.kh : holiday.en;
                    const textClass = holiday.isRestDay ? 'holiday-text' : 'event-text';
                    html += `<div class="day-info ${textClass}">${holidayText}</div>`;
                }
                
                // Buddhist event text (purple) - show for all dates
                const buddhistEvent = buddhistEvents[dateKey];
                if (buddhistEvent) {
                    const buddhistEventText = currentLanguage === 'kh' ? buddhistEvent.kh : buddhistEvent.en;
                    html += `<div class="day-info buddhist-event-text">${buddhistEventText}</div>`;
                }
                
                html += `</div>`;
                return html;
            }

            function renderAppointments() {
                const sortedAppointments = [...appointments].sort((a, b) => {
                    return new Date(a.date) - new Date(b.date);
                });
                
                let html = '';
                if (sortedAppointments.length === 0) {
                    html = `<div class="no-appointments">${currentLanguage === 'en' ? 'No appointments yet' : 'á˜á·á“á‘á¶á“áŸ‹á˜á¶á“á€á¶ášáá¶ááŸ‹á‡á½á”'}</div>`;
                } else {
                    sortedAppointments.forEach((apt, index) => {
                        const date = new Date(apt.date);
                        const dateStr = currentLanguage === 'en' 
                            ? `${translations.en.months[date.getMonth()]} ${date.getDate()}, ${date.getFullYear()}`
                            : `${date.getDate()} ${translations.kh.months[date.getMonth()]} ${date.getFullYear()}`;
                        
                        html += `<div class="appointment-item" onclick="editAppointment(${index})">`;
                        html += `<div class="appointment-date">${dateStr}</div>`;
                        html += `<div class="appointment-title">${apt.title}</div>`;
                        if (apt.time) {
                            html += `<div class="appointment-time">â° ${apt.time}</div>`;
                        }
                        html += `</div>`;
                    });
                }
                
                $('#appointmentsList').html(html);
            }

            function updateSidebarTitle() {
                $('#sidebarTitle').text(currentLanguage === 'en' ? 'Appointments' : 'á€á¶ášáá¶ááŸ‹á‡á½á”');
            }

            window.editAppointment = function(index) {
                // TODO: Open edit modal
                alert('Edit appointment: ' + appointments[index].title);
            };

            // Update button labels when language changes
            function updateButtonLabels() {
                if (currentLanguage === 'kh') {
                    $('#btnCopyText').text('á…á˜áŸ’á›á„á¢ááŸ’áá”á‘');
                    $('#btnAddAppointment').text('á”á“áŸ’ááŸ‚á˜á€á¶ášáá¶ááŸ‹á‡á½á”');
                } else {
                    $('#btnCopyText').text('Copy text');
                    $('#btnAddAppointment').text('Add Appointment');
                }
            }

            window.addAppointment = function() {
                if (!selectedDateInfo) return;
                const date = selectedDateInfo.date;
                const dateStr = formatDateKey(date);
                
                // TODO: Open add appointment modal
                const title = prompt(currentLanguage === 'en' ? 'Appointment title:' : 'á…áŸ†áá„á‡á¾á„á€á¶ášáá¶ááŸ‹á‡á½á”:');
                if (!title) return;
                
                const time = prompt(currentLanguage === 'en' ? 'Time (optional):' : 'á˜áŸ‰áŸ„á„ (áŸáŸ’ášáŸá…á…á·ááŸ’á):');
                
                appointments.push({
                    id: Date.now(),
                    date: dateStr,
                    title: title,
                    time: time || ''
                });
                
                localStorage.setItem('calendar-appointments', JSON.stringify(appointments));
                renderAppointments();
                closeDateModal();
                
                alert(currentLanguage === 'en' ? 'Appointment added!' : 'á”á¶á“á”á“áŸ’ááŸ‚á˜á€á¶ášáá¶ááŸ‹á‡á½á”!');
            };

            // Language Toggle
            $('#langToggle').click(function() {
                currentLanguage = currentLanguage === 'en' ? 'kh' : 'en';
                localStorage.setItem('calendar-language', currentLanguage);
                const flag = currentLanguage === 'en' ? 'ğŸ‡¬ğŸ‡§' : 'ğŸ‡°ğŸ‡­';
                const text = currentLanguage === 'en' ? 'English' : 'ááŸ’á˜áŸ‚áš';
                $(this).find('.lang-flag').text(flag);
                $(this).find('#langText').text(text);
                
                updateButtonLabels();
                updateSidebarTitle();
                renderCalendar();
                renderAppointments();
            });

            // Navigation
            $('.btn-prev-month').click(function() {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });

            $('.btn-next-month').click(function() {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });

            $('.btn-refresh').click(function() {
                currentDate = new Date();
                renderCalendar();
            });

            // Close modal on background click
            $('#dateModal').click(function(e) {
                if (e.target === this) {
                    closeDateModal();
                }
            });

            // Initialize
            updateButtonLabels();
            updateSidebarTitle();
            
            // Set initial language UI
            const flag = currentLanguage === 'en' ? 'ğŸ‡¬ğŸ‡§' : 'ğŸ‡°ğŸ‡­';
            const text = currentLanguage === 'en' ? 'English' : 'ááŸ’á˜áŸ‚áš';
            $('#langToggle').find('.lang-flag').text(flag);
            $('#langToggle').find('#langText').text(text);
            
            renderCalendar();
            renderAppointments();
            console.log('âœ… Khmer Lunar Calendar loaded successfully!');
        });
    </script>
</body>
</html>